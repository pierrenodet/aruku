<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-engine">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">Walk Engine | 歩く aruku</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://pierrenodet.github.io/aruku/aruku/docs/engine"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Walk Engine | 歩く aruku"><meta data-rh="true" name="description" content="Custom Graph Partition"><meta data-rh="true" property="og:description" content="Custom Graph Partition"><link data-rh="true" rel="icon" href="/aruku/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://pierrenodet.github.io/aruku/aruku/docs/engine"><link data-rh="true" rel="alternate" href="https://pierrenodet.github.io/aruku/aruku/docs/engine" hreflang="en"><link data-rh="true" rel="alternate" href="https://pierrenodet.github.io/aruku/aruku/docs/engine" hreflang="x-default"><link rel="stylesheet" href="/aruku/assets/css/styles.dd66fd0a.css">
<link rel="preload" href="/aruku/assets/js/runtime~main.850b8c01.js" as="script">
<link rel="preload" href="/aruku/assets/js/main.15cbefcf.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/aruku/"><b class="navbar__title text--truncate">歩く aruku</b></a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" target="_parent" href="/aruku/api/index.html">API</a><a class="navbar__item navbar__link" href="/aruku/docs/overview">Documentation</a><a href="https://github.com/pierrenodet/aruku" target="_self" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/aruku/docs/overview">Documentation</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aruku/docs/overview">Overview</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/aruku/docs/engine">Walk Engine</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aruku/docs/configuration">Configuration</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aruku/docs/transition">Transition Probability</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aruku/docs/walks">Provided Walks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/aruku/docs/example">Example</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/aruku/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Documentation</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Walk Engine</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Walk Engine</h1></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="custom-graph-partition">Custom Graph Partition<a class="hash-link" href="#custom-graph-partition" title="Direct link to heading">​</a></h2><p>One of the most significant caveats of random walks in a distributed environment is the amount of data exchanged between nodes at every step. Indeed, to send a walker to his next vertice, you need to send both the walker (relatively small) and a message for second-order random walks.</p><p>In spark, message passing is costly as it&#x27;s equivalent to data shuffling. To reduce the overall shuffling but still keep a high level of parallelism, we need to work at the executor level instead of the partition level.</p><p>So, inspired by the talk of Min Shen at Spark Summit 2017 [<a href="https://www.youtube.com/watch?v=lyVZNZZUdOk" target="_blank" rel="noopener noreferrer">talk</a>], a custom graph partition is implemented, being an adjacency list shared at the executor level. When sending a worker to his next step, we only need to shuffle the data if the next vertice is not in the same executor instead of being in a different partition, thus reducing the amount of shuffled data.</p><p><strong>aruku is distributed, but not out of core</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="routing-table">Routing Table<a class="hash-link" href="#routing-table" title="Direct link to heading">​</a></h2><p>With this custom graph partition, we have lost many cool features provided by GraphX being : </p><ul><li>distributed graph storing,</li><li>distributed message passing,</li><li>fault tolerance.</li></ul><p>To get the distributed message passing, we need to repartition our walkers with the right partitioner to get them in the required executors. We first aggregate the input graph by collecting neighbor edges of each vertex of the graph resulting in a PairRDD keyed by vertex ID. This PairRDD is repartitioned with the partitioner from the original VertexRDD, and custom graph partitions are built. Then the partitioner is used to send the walkers to the suitable executors by repartitioning the walkers PairRDD keyed by the vertex ID to which they need to be sent.</p><p>To get the fault tolerance back, we will use a routing table instead of just repartitioning our PairRDD of walkers. When building custom graph partitions from the PairRDD of neighbor edges, we keep the resulting empty RDD. So, after repartitioning the walkers PairRDD, we use the zipPartition function of this empty RDD with the walkers PairRDD to create a RDD lineage that would break if spark executors are lost, or tasks are failed.</p><p><strong>aruku is fault tolerant</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="optimized-edge-sampling">Optimized Edge Sampling<a class="hash-link" href="#optimized-edge-sampling" title="Direct link to heading">​</a></h2><p>Another tricky part of implementing efficient higher-order random walks for big graphs is the implementation of an efficient edge sampling algorithm. Indeed if the alias sampling works well to precompute sampling for the transition probabilities, it&#x27;s only suited for static walks. For dynamic walks, the space of possible transitions is too huge to precompute, thus requiring a clever algorithm.</p><p>KnightKing [<a href="https://github.com/KnightKingWalk/KnightKing" target="_blank" rel="noopener noreferrer">github</a>] is a general-purpose, distributed graph random walk engine that proposed several optimizations to random walk engines. One of these optimizations is an optimized rejection sampling to do edge sampling efficiently.</p><p><strong>aruku is fast, but probably slower than KnightKing</strong></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/pierrenodet/aruku/edit/master/../modules/aruku-docs/target/mdoc/engine.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vwxv"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/aruku/docs/overview"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Overview</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/aruku/docs/configuration"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configuration</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#custom-graph-partition" class="table-of-contents__link toc-highlight">Custom Graph Partition</a></li><li><a href="#routing-table" class="table-of-contents__link toc-highlight">Routing Table</a></li><li><a href="#optimized-edge-sampling" class="table-of-contents__link toc-highlight">Optimized Edge Sampling</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 Pierre Nodet</div></div></div></footer></div>
<script src="/aruku/assets/js/runtime~main.850b8c01.js"></script>
<script src="/aruku/assets/js/main.15cbefcf.js"></script>
</body>
</html>